<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	MacOS 本地编译 openJDK11 - xuzhihua blog
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="xuzhihua blog" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
					
					<h1><a href="index.html">xuzhihua blog</a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="_self" href="index.html">[Home]</a></li>
						
						  <li id=""><a target="_self" href="archives.html">[All Archives]</a></li>
						
						  <li id=""><a target="_self" href="Case.html">Case</a></li>
						
						  <li id=""><a target="_self" href="Mac.html">Mac</a></li>
						
						  <li id=""><a target="_self" href="OS.html">OS</a></li>
						
						  <li id=""><a target="_self" href="Algorithms.html">Algorithms</a></li>
						
						  <li id=""><a target="_self" href="NetWork.html">NetWork</a></li>
						
						  <li id=""><a target="_self" href="Apache.html">Apache</a></li>
						
						  <li id=""><a target="_self" href="Nginx.html">Nginx</a></li>
						
						  <li id=""><a target="_self" href="Oracle.html">Oracle</a></li>
						
						  <li id=""><a target="_self" href="MySQL.html">MySQL</a></li>
						
						  <li id=""><a target="_self" href="NoSQL.html">NoSQL</a></li>
						
						  <li id=""><a target="_self" href="Mybatis.html">Mybatis</a></li>
						
						  <li id=""><a target="_self" href="JVM.html">JVM</a></li>
						
						  <li id=""><a target="_self" href="Zookeeper.html">Zookeeper</a></li>
						
						  <li id=""><a target="_self" href="MQ.html">MQ</a></li>
						
						  <li id=""><a target="_self" href="Java.html">Java</a></li>
						
						  <li id=""><a target="_self" href="Idea.html">Idea</a></li>
						
						  <li id=""><a target="_self" href="JavaScript.html">JavaScript</a></li>
						
						  <li id=""><a target="_self" href="Shell.html">Shell</a></li>
						
						  <li id=""><a target="_self" href="Read.html">Read</a></li>
						
						  <li id=""><a target="_self" href="Video.html">Video</a></li>
						
						  <li id=""><a target="_self" href="jdkSource.html">jdkSource</a></li>
						
						  <li id=""><a target="_self" href="Fitness.html">Fitness</a></li>
						
						  <li id=""><a target="_self" href="AboutMe.html">AboutMe</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">













								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">MacOS 本地编译 openJDK11</h1>
		<div class="entry-content" itemprop="articleBody">
			<blockquote>
<p><a href="https://www.bilibili.com/video/BV1zT4y177Zf">JDK都没手动编译过，敢说自己是Java程序员吗？实战编译Java源码（JDK源码,JVM）视频教程</a></p>

<p>奇怪的问题，我第一次是想测试jdk14，结果make images之后，死活不生效，后来改成和视频中一样版本11，成功。 </p>
</blockquote>

<span id="more"></span><!-- more -->

<ul>
<li>
<a href="#toc_0">环境支持</a>
</li>
<li>
<a href="#toc_1">版本说明</a>
</li>
<li>
<a href="#toc_2">操作1:下载JDK源码</a>
</li>
<li>
<a href="#toc_3">操作2:安装</a>
</li>
<li>
<a href="#toc_4">使用: 注释与调试</a>
</li>
</ul>


<h2 id="toc_0">环境支持</h2>

<ol>
<li>bootstrap jdk 你想编译一个 jdk，你必须提前安装一个低一点 jdk(你想编译jdk11 那必须有一个jdk11或则10， 编译jdk14 需要jdk14或jdk13，  版本差太多时，下面执行sh configure时候会提示)</li>
<li>unix like 环境</li>
<li><p>编译器/编译工具链</p>

<ol>
<li>linux: gcc clang</li>
<li>macOS: Apple Xcode(using clang)</li>
<li>Solaris: Oracle Solaris Studio</li>
<li>AIX: IBM XL C/C++</li>
<li>Windows: Microsoft Visual Studioi</li>
</ol></li>
<li><p>其他支撑工具: autoconf/make/freetype</p></li>
</ol>

<h2 id="toc_1">版本说明</h2>

<ol>
<li>macOS: 10.15.5</li>
<li>bootstarp jdk: 11.0.8 (本地安装的 java -version)</li>
<li>Xcode: 11.5</li>
<li>clang: 11.0.3(本地安装的 clang --version)</li>
<li>clang++: 11.0.3(本地安装的 clang++ --version)</li>
<li>autoconf: 2.69(本地安装的 autoconf --version)</li>
<li>make: 3.81(本地安装的 make --version)</li>
<li>freetype: 2.10.1(本地安装的 freetype-config --ftversion)</li>
</ol>

<h2 id="toc_2">操作1:下载JDK源码</h2>

<ol>
<li><p>通过 mercurial 轻量级分布式版本控制系统下载(理解为另一种git)</p>

<ol>
<li>安装方法: terminal 输入 <code>pip install mercurial</code> 即可</li>
<li>验证方法: <code>hg --version</code></li>
<li>jdk源码网址: <a href="http://hg.openjdk.java.net/jdk">http://hg.openjdk.java.net/jdk</a></li>
<li>下载jdk: <code>hg clone http://hg.openjdk.java.net/jdk/jdk11/</code></li>
</ol></li>
<li><p>通过网址下载 <a href="http://jdk.java.net/">http://jdk.java.net/</a>      (选择jdk14 zipfile: <a href="https://download.java.net/openjdk/jdk11/ri/openjdk-11+28_src.zip">https://download.java.net/openjdk/jdk11/ri/openjdk-11+28_src.zip</a>)</p></li>
</ol>

<h2 id="toc_3">操作2:安装</h2>

<ol>
<li>新建目录 <code>/Users/xuzhihua/Workspace/0x04jdkCompile</code> 目录，并将上面下载到的zip解压到这里，改文件名，得到 <code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11</code></li>
<li>切换目录 <code>cd /Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11</code><br/></li>
<li><p>自动配置 <code>sh configure</code>    注意关注结束时有没有报错     成功的话会输出</p>

<blockquote>
<p>A new configuration has been successfully created in<br/>
/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/build/macosx-x86_64-server-release<br/>
using default settings.</p>
</blockquote></li>
<li><p>真正编译 <code>make all</code>    第一次会全量编译，耗时长，其中的一些告警可忽略不管   成功的话会输出</p>

<blockquote>
<p>Finished building target &#39;all&#39; in configuration &#39;macosx-x86_64-server-release&#39;</p>
</blockquote></li>
<li><p>编译完成，会在当前目录下生成 build 目录，所有的输出都在这里面</p>

<blockquote>
<p>编译后的目录: <code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/build/macosx-x86_64-server-release/</code><br/>
编译出来的成品目录: <code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/build/macosx-x86_64-server-release/images/jdk</code>    该内容与在oracle下载的jdk安装后的目录内容基本一样<br/>
编译后的可执行文件目录: <code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/build/macosx-x86_64-server-release/jdk/bin</code><br/>
验证一下 cd /Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/build/macosx-x86_64-server-release/jdk/bin<br/>
执行 <code>./java --version</code>  和 <code>java --version</code> 即可看到新编译的jdk与之前电脑环境的jdk输出信息<br/>
<img src="media/15958507410251/15958706753366.jpg" alt=""/></p>
</blockquote></li>
</ol>

<h2 id="toc_4">使用: 注释与调试</h2>

<ol>
<li><p>打开idea，新建工程 openjdk11CompileTest 的纯java应用，输出 Hello world! 截图如下 使用的jdk是电脑环境之前的jdk11，不是刚刚编译出来的jdk<br/>
<img src="media/15958507410251/15958708214209.jpg" alt=""/></p></li>
<li><p>更换sdk(按下cmd+; 找到SDKs): 删除之前的jdk，点击➕ add jdk，目录指向 <code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/build/macosx-x86_64-server-release/images/jdk</code>，idea重新扫描文件后，重新允许main方法，截图如下 使用的jdk已经改成了刚刚手动编译的openjdk11<br/>
<img src="media/15958507410251/15958707621477.jpg" alt=""/></p></li>
<li><p>关联jdk原码(按下cmd+; 在SDKs-Sourcepath)，删除这里面所有的内容(这里默认使用生成build下面images里面的src.zip的内容)  这里的源码没法修改 并加注释，故删除掉，然后重新关联，指向目录<code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11/src</code>  这里是真正的源码位置，关联确认后，idea会再次重新扫描文件</p></li>
<li><p>这个时候在main方法里面进 print 方法，截图如下， 即真正源码的位置，关联上了<br/>
<img src="media/15958507410251/15958704006332.jpg" alt=""/></p></li>
<li><p>修改源码的print方法，添加定制化内容，此时输出没有带出定制化的内容，需要操作步骤6，再运行(!!!注意 添加的定制化内容，注释或者任何东西，不要有中文 老老实实用英文，不然会有错误)<br/>
<img src="media/15958507410251/15958716012522.jpg" alt=""/></p></li>
<li><p>将步骤5中修改的源码，重新打包生成镜像后 ，在 <code>/Users/xuzhihua/Workspace/0x04jdkCompile/openjdk11</code> 目录下执行 <code>make images</code>  (上面make all第一次执行是全量编译，比较慢，这次是增量编译，比较快, emmm 视频里比较快，我的电脑还是老老实实的慢 4min左右)，终端下编译成功后，切换到idea，他会自动重新扫描文件，扫描后再运行， 这次输出是成功的，带有定制化信息，断点也可以正常进入(如果断点不能进入，需要看一下上面关联的jdk和sourcepath是不是对的)<br/>
<img src="media/15958507410251/15958719725243.jpg" alt=""/><br/>
<img src="media/15958507410251/15958720382400.jpg" alt=""/></p></li>
</ol>

		</div>
	</article>
	<div class="share-comment">
	 

	  

	  

	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  
    



</body>
</html>